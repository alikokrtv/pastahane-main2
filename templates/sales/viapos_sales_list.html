{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-6">
  <h1 class="text-2xl font-semibold mb-4">ViaPos Tüm Satışlar</h1>

  <!-- Filters -->
  <form method="get" class="grid grid-cols-1 md:grid-cols-6 gap-3 bg-white p-4 rounded shadow">
    <input type="text" name="q" value="{{ filters.q }}" placeholder="Ürün/Müşteri/Fiş/Barkod" class="border rounded px-3 py-2">
    <input type="text" name="group" value="{{ filters.group }}" placeholder="Grup" class="border rounded px-3 py-2">
    <input type="text" name="payment" value="{{ filters.payment }}" placeholder="Ödeme" class="border rounded px-3 py-2">
    <input type="text" name="branch" value="{{ filters.branch }}" placeholder="Şube (Çarşı/Vega/Genel)" class="border rounded px-3 py-2">
    <input type="datetime-local" name="date_from" value="{{ filters.date_from }}" class="border rounded px-3 py-2">
    <input type="datetime-local" name="date_to" value="{{ filters.date_to }}" class="border rounded px-3 py-2">

    <div class="md:col-span-6 flex gap-2">
      <button class="bg-blue-600 text-white px-4 py-2 rounded" type="submit">Filtrele</button>
      <a class="bg-gray-200 px-4 py-2 rounded" href="?">Temizle</a>
      <a class="bg-green-600 text-white px-4 py-2 rounded" href="{% url 'sales:viapos-sales-export' %}?{{ request.GET.urlencode }}">CSV Dışa Aktar</a>
    </div>
  </form>

  <!-- Summary -->
  <div class="mt-4 text-sm text-gray-700">
    <span class="mr-4">Toplam Kayıt: <strong>{{ total_count }}</strong></span>
    <span>Toplam Tutar: <strong>₺{{ total_amount|floatformat:2 }}</strong></span>
  </div>

  <!-- Table -->
  <div class="mt-4 overflow-x-auto bg-white rounded shadow">
    <table class="min-w-full divide-y divide-gray-200">
      <thead>
        <tr>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Fiş No</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tarih</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Müşteri</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ürün</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Grup</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Miktar</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Birim</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Fiyat</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tutar</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Kar</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ödeme</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Kasiyer</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Şube</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Barkod</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        {% for r in rows %}
        <tr>
          <td class="px-3 py-2 text-sm">{{ r.id }}</td>
          <td class="px-3 py-2 text-sm">{{ r.fisno }}</td>
          <td class="px-3 py-2 text-sm text-gray-600">{{ r.date|date:"d.m.Y H:i" }}</td>
          <td class="px-3 py-2 text-sm">{{ r.customer }}</td>
          <td class="px-3 py-2 text-sm">{{ r.product }}</td>
          <td class="px-3 py-2 text-sm">{{ r.group }}</td>
          <td class="px-3 py-2 text-sm">{{ r.quantity|floatformat:0 }}</td>
          <td class="px-3 py-2 text-sm">{{ r.unit|upper }}</td>
          <td class="px-3 py-2 text-sm">₺{{ r.price|floatformat:2 }}</td>
          <td class="px-3 py-2 text-sm font-medium">₺{{ r.amount|floatformat:2 }}</td>
          <td class="px-3 py-2 text-sm">₺{{ r.profit|floatformat:2 }}</td>
          <td class="px-3 py-2 text-sm">{{ r.payment }}</td>
          <td class="px-3 py-2 text-sm">{{ r.cashier }}</td>
          <td class="px-3 py-2 text-sm">{{ r.branch }}</td>
          <td class="px-3 py-2 text-sm">{{ r.barcode }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="14" class="px-3 py-6 text-center text-gray-500">Kayıt bulunamadı</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="mt-4 flex items-center gap-2">
    {% if page_obj.has_previous %}
      <a class="px-3 py-1 border rounded" href="?page={{ page_obj.previous_page_number }}&{{ request.GET.urlencode|cut:'page='|safe }}">Önceki</a>
    {% endif %}
    <span>Sayfa {{ page_obj.number }} / {{ paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a class="px-3 py-1 border rounded" href="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode|cut:'page='|safe }}">Sonraki</a>
    {% endif %}
  </div>
</div>
{% endblock %}
